# 250422_화요일
> ### 목차
1. [Self-Healing CI/CD 구체화](#1-self-healing-cicd-구체화)
2. [특정 서버 docker 컨테이너 로그 가져오는 api 구현](#2-특정-서버의-docker컨테이너-로그-가져오는-api-구현)
3. [프롬프트 초기 가이드라인 작성](#3-ai-프롬프트-초기-가이드라인-작성)

---
### 1. Self-Healing CI/CD 구체화
```
git push
   ↓
Jenkins CI/CD 실행
   ↓
빌드 실패 감지 (자동)
   ↓
어플리케이션 추적 (Stage 이름 기반)
   ↓
문제 파일 & 로그 수집
   ↓
GPT로 코드 수정 요청
   ↓
GitLab Commit + Jenkins 재배포
   ↓
성공 시 자동 Merge (옵션)
```

### 2. 특정 서버의 docker컨테이너 로그 가져오는 API 구현
+ 구현 메서드, 특정 어플리케이션의 특정 시간 이내의 로그만 긁어오기
  ```
    public static String getRecentDockerLogs(String ip, String pemPath, String containerName, String sinceDuration) {
        StringBuilder log = new StringBuilder();

        try {
            JSch jsch = new JSch();
            jsch.addIdentity(pemPath);

            Session session = jsch.getSession("ubuntu", ip, 22);
            session.setConfig("StrictHostKeyChecking", "no");
            session.connect();

            ChannelExec channel = (ChannelExec) session.openChannel("exec");
            String command = String.format("docker logs --since %s %s", sinceDuration, containerName);
            channel.setCommand(command);

            InputStream input = channel.getInputStream();
            channel.connect();

            try (BufferedReader reader = new BufferedReader(new InputStreamReader(input))) {
                String line;
                while ((line = reader.readLine()) != null) {
                    log.append(line).append("\n");
                }
            }

            channel.disconnect();
            session.disconnect();

            return log.toString();

        } catch (Exception e) {
            throw new RuntimeException("도커 로그 가져오기 실패", e);
        }
    }
  ```



### 3. AI 프롬프트 초기 가이드라인 작성
+ 작성이유: AI 담당 공예슬 팀원이 작업해야할 gitdiff+어플리케이션 에러 로그+jenkins폴더 구조를 자료로 줬을때의 원하는 코드 결과를 가져오게 하기위해 가이드라인 작성
+ 진행 내용
  + 프롬프트
  ```
  아래 같은 내용이 있을때 어느 부분의 코드가 의심되고 소스가 필요한 파일을 
  json형태로 순차적으로 적어줘. 경로도! 그외에는 적지마
  1. git diff
  {
      "commit": {
        해당 merge된 내용 총 정보
      },
      "commits": [
          {
            실제 커밋하나하나의 내용
          }
      ],
      "diffs": [
        실제 변경된 내용들
      ]
  }
  2. 트리 구조
  /var/lib/jenkins/workspace/drum-dummy11/backend/src
  ├── main
  │   ├── java(하단은 생략)
  │   └── resources
  │       └── application.properties
  └── test

  3. 해당 어플리케이션 에러 로그 
  ***************************
  APPLICATION FAILED TO START
  ***************************

  Description:

  The dependencies of some of the beans in the application context form a cycle:

    userNumberController defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/org/example/backend/controller/UserNumberController.class]
  ┌─────┐
  |  basicServiceImpl defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/org/example/backend/domain/userNumber/service/BasicServiceImpl.class]
  ↑     ↓
  |  secondaryServiceImpl defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/org/example/backend/domain/userNumber/service/SecondaryServiceImpl.class]
  └─────┘
  ```
  + 답변
  ```
  [
    {
      "file": "backend/src/main/java/org/example/backend/domain/userNumber/service/BasicService.java",
      "codeSection": "void basicCircular();"
    },
    {
      "file": "backend/src/main/java/org/example/backend/domain/userNumber/service/BasicServiceImpl.java",
      "codeSection": "private final SecondaryService secondaryService; ... public void basicCircular() { secondaryService.circular(); }"
    },
    {
      "file": "backend/src/main/java/org/example/backend/domain/userNumber/service/SecondaryService.java",
      "codeSection": "public interface SecondaryService { void circular(); }"
    },
    {
      "file": "backend/src/main/java/org/example/backend/domain/userNumber/service/SecondaryServiceImpl.java",
      "codeSection": "private final BasicService basicService; ... public void circular() { basicService.basicCircular(); }"
    }
  ]
  ```