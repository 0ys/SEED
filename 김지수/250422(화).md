# 250422_화요일
> ### 목차
1. [AWS EC2 인스턴스 2개 생성 및 IAM 계정 생성](#1-aws-ec2-인스턴스-2개-생성-및-iam-계정-생성)
2. [Self-Healing CI/CD 설계](#2-self-healing-cicd-설계)
3. [더미 프로젝트 자동 배포 연결](#3-더미-프로젝트-자동-배포-연결)
4. [Jenkins캐시 내용 살펴보기](#4-jenkins캐시-내용-살펴보기)

---
### 1. AWS EC2 인스턴스 2개 생성 및 IAM 계정 생성
- 실제 더미 프로젝트를 띄울 테스트용 서버 2개 생성
  - 스팩: EC2 Meidum, 2cpu & 4GB 
  - 생성 방법 참고: "스프링 부트와 AWS로 혼자 구현하는 웹 서비스" 책 서버 챕터 내용
- IAM 계정 생성 및 팀에 공유
  - 권한: EC2 full access, s3 full access, billing access

### 2. Self-Healing CI/CD 설계
Flow
1. Push이후 배포 실패 
    - 트리거:
        - Jenkins에서 자동 배포 실행
    - 실패 감지:
        - Jenkins API or GitLab CI API로 파이프라인 상태 조회, 각 어플리케이션별 healtcheck 필요
2. 문제 어플리케이션 확인 로직 
    - 소스: Jenkins 빌드 에러 로그 + 사용중인 어플리케이션 목록
    - 결과: 해당 문제 어플리케이션
3. 문제 파일&코드 파악
    - 소스: 어플리케이션 에러 로그 + git diff + jenkins 캐시 폴더 구조
    - 리팩토링 소스: 어플리케이션 에러 로그 + git diff + diff된 파일들 code source
4. 문제 코드 수정 
5. 적용 및 재배포

### 3. 더미 프로젝트 자동 배포 연결
+ 진행 이유: Self-Healing에 활용한 Jenkins의 캐시 내용을 보기 위해 팀원 박유진이 만든 더미 프로젝트에 자동 배포 구축
  + 참고 내용: 이전 프로젝트의 Jenkins 자동배포 개발위키 참고
  + 주요 코드
  ~~~ 
  # JAVA 설치
  sudo apt install -y openjdk-17-jdk

  # GPG 키 내려받아 시스템에 등록
  wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key \
    | sudo apt-key add -
    
  # APT 소스 리스트에 Jenkins 저장소 등록  
  sudo sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ \
    > /etc/apt/sources.list.d/jenkins.list'
    
  # Jenkins 설치
  sudo apt install -y jenkins

  # Jenkins 시작
  sudo systemctl start jenkins

  sudo rm -rf /var/lib/jenkins/*
  sudo systemctl start jenkins

  # GitLab Plugin만 설치
  sudo jenkins-plugin-cli --plugins gitlab-plugin
  sudo systemctl restart jenkins

  # jenkins 설정 파일 열기
  sudo nano /lib/systemd/system/jenkins.service

  sudo systemctl restart jenkins
  ~~~ 

### 4. Jenkins캐시 내용 살펴보기
- **캐시(워크스페이스)**
    - `/var/lib/jenkins/jobs/<JobName>/workspace/` 또는 `/var/lib/jenkins/workspace/<JobName>/`
    - 이전 빌드 산출물(`node_modules/`, `target/` 등)과 untracked 파일이 남아 빌드 속도를 높이지만,
        
        때로는 깨끗한 빌드를 위해 `cleanWs()` 또는 Freestyle의 “Delete workspace before build” 옵션 필요
        
- **파이프라인 정의**
    - `/var/lib/jenkins/jobs/<JobName>/config.xml`
    - Declarative Pipeline일 경우 UI에서 “Pipeline script”로 관리
- **커밋 이력(changelog)**
    - 각 빌드 폴더에 `changelog*.xml` (예: `changelog8188949111084233029.xml`)
    - `<commit>`(SHA), `<parent>`(부모 SHA), author, message 
