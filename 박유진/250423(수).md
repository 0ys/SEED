# 250423_수요일
> ### 목차
1. [Gitlab API_repository 관련](#1-gitlab_레포지토리-url로-레포지토리-정보-가져오기)
2. [Gitlab API_Create branch](#2-gitlab_브랜치-생성)
3. [Tomorrow](#3-내일-할일)

---
### 1. Gitlab_레포지토리 URL로 레포지토리 정보 가져오기
- 현재 레포지토리 id로 조회하는 api는 있지만, url로 조회하는 것도 필요할 것으로 판단해서 추가함.

<details>
<summary>API 상세</summary>

```markdown
POST /api/gitlab/projects

<req>
{ "repositoryUrl": "https://lab.ssafy.com/...깃랩 레포지토리 URL" }

<res>
{
  "success": true,
  "message": "string",
  "data": {
    "id": 0,                // 레포지토리 id
    "name": "string",       // 레포지토리 이름
    "visibility": "string", // private, internal, public 
    "path_with_namespace": "string",
    "http_url_to_repo": "string"
  }
}

```

</details>
<br>

---
### 2. Gitlab_브랜치 생성
- 새로운 브랜치를 생성하는 api
<details>
<summary>API 상세</summary>

```markdown
POST /api/gitlab/{projectId}/branches
params : branch_새로운브랜치명, ref=루트가 될 브랜치명

<res>
{
  "commit": {
    "id": "7b5c3cc8be40ee161ae89a06bba6229da1032a0c",
    "short_id": "7b5c3cc",
    "created_at": "2012-06-28T03:44:20-07:00",
    "parent_ids": [
      "4ad91d3c1144c406e50c7b33bae684bd6837faf8"
    ],
    "title": "add projects API",
    "message": "add projects API",
    "author_name": "John Smith",
    "author_email": "john@example.com",
    "authored_date": "2012-06-27T05:51:39-07:00",
    "committer_name": "John Smith",
    "committer_email": "john@example.com",
    "committed_date": "2012-06-28T03:44:20-07:00",
    "trailers": {},
    "web_url": "https://gitlab.example.com/my-group/my-project/-/commit/7b5c3cc8be40ee161ae89a06bba6229da1032a0c"
  },
  "name": "newbranch",
  "merged": false,
  "protected": false,
  "default": false,
  "developers_can_push": false,
  "developers_can_merge": false,
  "can_push": true,
  "web_url": "https://gitlab.example.com/my-group/my-project/-/tree/newbranch"
}

```

</details>

<br>

```
< 트러블 슈팅 : 403 권한문제 >
[x] header 체크 _ accesstoken에 다른 값이 들어가는지
[x] api 인코딩 문제 있는지 확인
[x] controller-service-api 로직 흐름 검토
[x] 깃랩 브라우저에서 토큰 권한 체크(write_repository등)

[문제 부분] : buildGitlabAuthorizationUrl에서 queryParam으로 scope 지정.
(1. 깃랩 브라우저에서 설정 == "이 어플리케이션이 요청할 수 있는 권한"을 정의)
(2. 인증 요청에서 설정 == scope 파라미터로 "사용자에게 실제로 부여할 권한"을 지정)

[느낀점]
1. 문제 해결에 시간 오래 걸린다 싶으면 바로 물어보자
2. 디버깅할 때, 새로 추가한 코드만 보지 말고 이전 로직과 흐름을 전체적으로 생각하자

```
---
### 3. 내일 할일

- Delete branch api
- merge
  - [병합 참조](https://docs.gitlab.com/api/merge_requests/#merge-to-default-merge-ref-path)
  - accept+merge
  - auto-merge
  - rebase
  
- 발표자료
- 도커 관련 api 활용방안 검토
- 코드 리팩토링 : 에러코드명 검토, api 인코딩 등 통일, 중복 로직 정리..
